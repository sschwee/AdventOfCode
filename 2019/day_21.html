<script>
	const input = "109,2050,21101,0,966,1,21101,0,13,0,1105,1,1378,21102,1,20,0,1105,1,1337,21102,27,1,0,1106,0,1279,1208,1,65,748,1005,748,73,1208,1,79,748,1005,748,110,1208,1,78,748,1005,748,132,1208,1,87,748,1005,748,169,1208,1,82,748,1005,748,239,21102,1,1041,1,21101,0,73,0,1105,1,1421,21102,1,78,1,21102,1,1041,2,21101,88,0,0,1106,0,1301,21101,0,68,1,21102,1041,1,2,21101,103,0,0,1105,1,1301,1102,1,1,750,1106,0,298,21102,1,82,1,21101,1041,0,2,21102,1,125,0,1106,0,1301,1101,2,0,750,1105,1,298,21102,79,1,1,21102,1041,1,2,21102,1,147,0,1106,0,1301,21101,0,84,1,21102,1041,1,2,21102,1,162,0,1106,0,1301,1101,0,3,750,1106,0,298,21101,0,65,1,21101,0,1041,2,21102,1,184,0,1105,1,1301,21101,76,0,1,21101,1041,0,2,21102,1,199,0,1105,1,1301,21101,0,75,1,21101,1041,0,2,21102,214,1,0,1105,1,1301,21101,0,221,0,1105,1,1337,21101,10,0,1,21101,1041,0,2,21102,1,236,0,1106,0,1301,1105,1,553,21102,85,1,1,21102,1041,1,2,21102,254,1,0,1106,0,1301,21101,0,78,1,21101,1041,0,2,21101,0,269,0,1105,1,1301,21101,276,0,0,1105,1,1337,21101,0,10,1,21101,0,1041,2,21101,0,291,0,1106,0,1301,1101,0,1,755,1105,1,553,21102,32,1,1,21101,0,1041,2,21101,313,0,0,1106,0,1301,21102,1,320,0,1106,0,1337,21101,0,327,0,1106,0,1279,1202,1,1,749,21102,1,65,2,21102,1,73,3,21102,346,1,0,1105,1,1889,1206,1,367,1007,749,69,748,1005,748,360,1102,1,1,756,1001,749,-64,751,1106,0,406,1008,749,74,748,1006,748,381,1101,-1,0,751,1105,1,406,1008,749,84,748,1006,748,395,1101,0,-2,751,1106,0,406,21101,0,1100,1,21102,1,406,0,1106,0,1421,21102,32,1,1,21102,1100,1,2,21102,421,1,0,1106,0,1301,21101,0,428,0,1106,0,1337,21102,435,1,0,1106,0,1279,1201,1,0,749,1008,749,74,748,1006,748,453,1101,-1,0,752,1106,0,478,1008,749,84,748,1006,748,467,1102,-2,1,752,1105,1,478,21102,1,1168,1,21102,1,478,0,1106,0,1421,21101,0,485,0,1105,1,1337,21102,10,1,1,21102,1168,1,2,21101,500,0,0,1105,1,1301,1007,920,15,748,1005,748,518,21101,1209,0,1,21102,1,518,0,1106,0,1421,1002,920,3,529,1001,529,921,529,101,0,750,0,1001,529,1,537,101,0,751,0,1001,537,1,545,1001,752,0,0,1001,920,1,920,1106,0,13,1005,755,577,1006,756,570,21101,0,1100,1,21102,570,1,0,1106,0,1421,21101,987,0,1,1105,1,581,21102,1,1001,1,21101,588,0,0,1105,1,1378,1102,1,758,594,102,1,0,753,1006,753,654,21002,753,1,1,21102,1,610,0,1106,0,667,21101,0,0,1,21101,621,0,0,1105,1,1463,1205,1,647,21102,1015,1,1,21101,635,0,0,1106,0,1378,21101,0,1,1,21101,0,646,0,1105,1,1463,99,1001,594,1,594,1106,0,592,1006,755,664,1102,1,0,755,1105,1,647,4,754,99,109,2,1102,726,1,757,22101,0,-1,1,21102,1,9,2,21102,697,1,3,21102,692,1,0,1106,0,1913,109,-2,2106,0,0,109,2,101,0,757,706,2102,1,-1,0,1001,757,1,757,109,-2,2106,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,255,63,191,95,127,159,223,0,221,205,207,107,233,228,174,140,77,181,216,57,170,172,179,167,200,100,121,50,244,43,138,62,184,163,84,118,124,201,86,87,206,78,162,71,220,248,99,94,153,247,61,109,69,215,214,243,46,217,173,85,198,188,169,156,175,60,70,204,234,51,239,154,101,56,232,155,235,143,120,116,229,187,103,137,157,212,142,245,92,250,42,166,59,158,110,171,39,126,199,251,93,178,68,189,54,177,185,49,123,122,139,237,230,108,106,168,35,190,113,53,115,38,252,197,58,186,79,222,241,111,114,34,125,102,254,227,253,55,219,226,213,182,152,231,238,47,76,242,117,183,246,119,203,136,202,196,249,218,141,236,98,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,73,110,112,117,116,32,105,110,115,116,114,117,99,116,105,111,110,115,58,10,13,10,87,97,108,107,105,110,103,46,46,46,10,10,13,10,82,117,110,110,105,110,103,46,46,46,10,10,25,10,68,105,100,110,39,116,32,109,97,107,101,32,105,116,32,97,99,114,111,115,115,58,10,10,58,73,110,118,97,108,105,100,32,111,112,101,114,97,116,105,111,110,59,32,101,120,112,101,99,116,101,100,32,115,111,109,101,116,104,105,110,103,32,108,105,107,101,32,65,78,68,44,32,79,82,44,32,111,114,32,78,79,84,67,73,110,118,97,108,105,100,32,102,105,114,115,116,32,97,114,103,117,109,101,110,116,59,32,101,120,112,101,99,116,101,100,32,115,111,109,101,116,104,105,110,103,32,108,105,107,101,32,65,44,32,66,44,32,67,44,32,68,44,32,74,44,32,111,114,32,84,40,73,110,118,97,108,105,100,32,115,101,99,111,110,100,32,97,114,103,117,109,101,110,116,59,32,101,120,112,101,99,116,101,100,32,74,32,111,114,32,84,52,79,117,116,32,111,102,32,109,101,109,111,114,121,59,32,97,116,32,109,111,115,116,32,49,53,32,105,110,115,116,114,117,99,116,105,111,110,115,32,99,97,110,32,98,101,32,115,116,111,114,101,100,0,109,1,1005,1262,1270,3,1262,20102,1,1262,0,109,-1,2105,1,0,109,1,21101,1288,0,0,1105,1,1263,21002,1262,1,0,1101,0,0,1262,109,-1,2105,1,0,109,5,21101,1310,0,0,1106,0,1279,21201,1,0,-2,22208,-2,-4,-1,1205,-1,1332,21201,-3,0,1,21102,1332,1,0,1105,1,1421,109,-5,2105,1,0,109,2,21102,1346,1,0,1105,1,1263,21208,1,32,-1,1205,-1,1363,21208,1,9,-1,1205,-1,1363,1105,1,1373,21102,1,1370,0,1105,1,1279,1105,1,1339,109,-2,2105,1,0,109,5,1202,-4,1,1385,21002,0,1,-2,22101,1,-4,-4,21101,0,0,-3,22208,-3,-2,-1,1205,-1,1416,2201,-4,-3,1408,4,0,21201,-3,1,-3,1106,0,1396,109,-5,2105,1,0,109,2,104,10,21202,-1,1,1,21102,1,1436,0,1106,0,1378,104,10,99,109,-2,2105,1,0,109,3,20002,594,753,-1,22202,-1,-2,-1,201,-1,754,754,109,-3,2106,0,0,109,10,21101,5,0,-5,21102,1,1,-4,21101,0,0,-3,1206,-9,1555,21102,1,3,-6,21101,5,0,-7,22208,-7,-5,-8,1206,-8,1507,22208,-6,-4,-8,1206,-8,1507,104,64,1106,0,1529,1205,-6,1527,1201,-7,716,1515,21002,0,-11,-8,21201,-8,46,-8,204,-8,1105,1,1529,104,46,21201,-7,1,-7,21207,-7,22,-8,1205,-8,1488,104,10,21201,-6,-1,-6,21207,-6,0,-8,1206,-8,1484,104,10,21207,-4,1,-8,1206,-8,1569,21101,0,0,-9,1106,0,1689,21208,-5,21,-8,1206,-8,1583,21101,1,0,-9,1105,1,1689,1201,-5,716,1588,21001,0,0,-2,21208,-4,1,-1,22202,-2,-1,-1,1205,-2,1613,22101,0,-5,1,21102,1613,1,0,1105,1,1444,1206,-1,1634,22101,0,-5,1,21101,0,1627,0,1106,0,1694,1206,1,1634,21102,1,2,-3,22107,1,-4,-8,22201,-1,-8,-8,1206,-8,1649,21201,-5,1,-5,1206,-3,1663,21201,-3,-1,-3,21201,-4,1,-4,1105,1,1667,21201,-4,-1,-4,21208,-4,0,-1,1201,-5,716,1676,22002,0,-1,-1,1206,-1,1686,21102,1,1,-4,1105,1,1477,109,-10,2106,0,0,109,11,21101,0,0,-6,21102,1,0,-8,21101,0,0,-7,20208,-6,920,-9,1205,-9,1880,21202,-6,3,-9,1201,-9,921,1725,20102,1,0,-5,1001,1725,1,1733,20101,0,0,-4,22101,0,-4,1,21102,1,1,2,21101,0,9,3,21101,1754,0,0,1105,1,1889,1206,1,1772,2201,-10,-4,1767,1001,1767,716,1767,20101,0,0,-3,1105,1,1790,21208,-4,-1,-9,1206,-9,1786,22101,0,-8,-3,1105,1,1790,21201,-7,0,-3,1001,1733,1,1796,20102,1,0,-2,21208,-2,-1,-9,1206,-9,1812,22101,0,-8,-1,1106,0,1816,21201,-7,0,-1,21208,-5,1,-9,1205,-9,1837,21208,-5,2,-9,1205,-9,1844,21208,-3,0,-1,1105,1,1855,22202,-3,-1,-1,1105,1,1855,22201,-3,-1,-1,22107,0,-1,-1,1106,0,1855,21208,-2,-1,-9,1206,-9,1869,21202,-1,1,-8,1106,0,1873,22101,0,-1,-7,21201,-6,1,-6,1106,0,1708,22102,1,-8,-10,109,-11,2105,1,0,109,7,22207,-6,-5,-3,22207,-4,-6,-2,22201,-3,-2,-1,21208,-1,0,-6,109,-7,2106,0,0,0,109,5,1202,-2,1,1912,21207,-4,0,-1,1206,-1,1930,21102,1,0,-4,22101,0,-4,1,22101,0,-3,2,21102,1,1,3,21102,1949,1,0,1105,1,1954,109,-5,2105,1,0,109,6,21207,-4,1,-1,1206,-1,1977,22207,-5,-3,-1,1206,-1,1977,21201,-5,0,-5,1105,1,2045,22102,1,-5,1,21201,-4,-1,2,21202,-3,2,3,21102,1996,1,0,1106,0,1954,21202,1,1,-5,21101,1,0,-2,22207,-5,-3,-1,1206,-1,2015,21102,1,0,-2,22202,-3,-2,-3,22107,0,-4,-1,1206,-1,2037,22101,0,-2,1,21102,1,2037,0,106,0,1912,21202,-3,-1,-3,22201,-5,-3,-5,109,-6,2106,0,0";
	var dataStruct = {};
	dataStruct.inputStruct = getInputStruct(input);
	dataStruct.counter = 0;
	dataStruct.base = 0;

	const AND = ["A".charCodeAt(0), "N".charCodeAt(0), "D".charCodeAt(0)];
	const NOT = ["N".charCodeAt(0), "O".charCodeAt(0), "T".charCodeAt(0)];
	const OR = ["O".charCodeAt(0), "R".charCodeAt(0)];
	const T = "T".charCodeAt(0);
	const J = "J".charCodeAt(0);
	const A = "A".charCodeAt(0);
	const B = "B".charCodeAt(0);
	const C = "C".charCodeAt(0);
	const D = "D".charCodeAt(0);
	const E = "E".charCodeAt(0);
	const F = "F".charCodeAt(0);
	const G = "G".charCodeAt(0);
	const H = "H".charCodeAt(0);
	const I = "I".charCodeAt(0);
	const NEW = 10;
	const SPACE = 32;
	const WALK = ["W".charCodeAt(0), "A".charCodeAt(0), "L".charCodeAt(0), "K".charCodeAt(0), NEW];
	const RUN = ["R".charCodeAt(0), "U".charCodeAt(0), "N".charCodeAt(0), NEW];
	
	const instructions = [];
	instructions[0] = [...NOT, SPACE, A, SPACE, J, NEW];
	instructions[1] = [...NOT, SPACE, B, SPACE, T, NEW];
	instructions[2] = [...OR, SPACE, T, SPACE, J, NEW];
	instructions[3] = [...NOT, SPACE, C, SPACE, T, NEW];
	instructions[4] = [...OR, SPACE, T, SPACE, J, NEW];
	instructions[5] = [...AND, SPACE, D, SPACE, J, NEW];
	instructions[6] = [...NOT, SPACE, E, SPACE, T, NEW];
	instructions[7] = [...NOT, SPACE, T, SPACE, T, NEW];
	instructions[8] = [...OR, SPACE, H, SPACE, T, NEW];
	instructions[9] = [...AND, SPACE, T, SPACE, J, NEW];
	
	var outputArray = [];
	var output = "";
	var inputId = 10;
	var outputLine = "";
	while(true) {
		
		output = intcodeComputer(dataStruct, RUN);
		if (output == "END") {
			renderGame(outputArray);
			break;
		}
		outputArray.push(output);
		
		if (output == 10) {
			if (outputLine == "Input instructions:") {
				renderGame(outputArray);
				outputLine = "";
				for (var i in instructions) {
					output = intcodeComputer(dataStruct, instructions[i]);
					outputLine += String.fromCharCode(output);
					outputArray.push(output);
					renderGame(outputArray);
				}
			} else {
				outputLine = "";
			}
		} else {
			outputLine += String.fromCharCode(output);
		}
	}


	const xMax = 44;
	const yMax = 46;


	function renderGame(outputArray) {
		
		var gameString = "";
		
		for (var i=0; i<outputArray.length; i++) {
			var output = outputArray[i];
			if (output == 35) {
				gameString += "#";
			} else if (output == 46) {
				gameString += ".";
			} else if (output == 10) {
				gameString += "\n";
				continue;
			} else if (output == 94) {
				gameString += "^";
			} else if (output == 60) {
				gameString += "<";
			} else if (output == 62) {
				gameString += ">"
			} else if (output == 86) {
				gameString += "v";
			} else if (output == 88) {
				gameString += "X";
			} else if (i == outputArray.length -1) {
				gameString += output;
			} else {
				gameString += String.fromCharCode(output);
			}
		}
		console.log(gameString);
	}



	function getInputStruct(input) {
		
		var inputArray = input.split(",");
		var inputStruct = {};
		for (var i=0; i<inputArray.length; i++) {
			inputStruct[i] = inputArray[i]*1;
		}
		
		return inputStruct;
	}


	function getParameters(struct, pos, n) {
		
		var params = [];
		var modes = Math.floor(struct[pos] / 100);
		for (var j=1; j<=n; j++) {
			var tempStruct = {};
			tempStruct.mode = modes % 10;
			tempStruct.value = struct[pos+j];
			params.push(tempStruct);
			
			modes = Math.floor(modes / 10);
		}
		
		return params;
	}


	function getValue(struct, parameter, base) {
		
		var address = 0;
		switch(parameter.mode) {
			
			case 0:
				address = parameter.value;
				break;
			case 1:
				return parameter.value;
			case 2:
				address = parameter.value + base;
				break;
			default:
				throw("BAD PARAMETER MODE: " + parameter.mode);
		}
		
		if (!(address in struct)) {
			struct[address] = 0;
		}
		
		return struct[address];
	}


	function putValue(struct, parameter, val, base){
		
		var address = 0;
		switch(parameter.mode) {
			
			case 0:
				address = parameter.value;
				break;
			case 1:
				throw("CANNOT WRITE TO IMMEDIATE MODE: "+parameter.mode);
			case 2:
				address = parameter.value + base;
				break;
			default:
				throw("BAD PARAMETER MODE: "+parameter.mode);
		}
		struct[address] = val;
	}


	// intcode computer with struct to keep states

	function intcodeComputer(data_struct, inputArray) {
		
		var inputArray = (typeof inputArray == 'undefined') ? [] : inputArray;
		var inputCounter = 0;
		var outputArray = [];
		while(data_struct.counter<Math.max(...Object.keys(data_struct.inputStruct))) {
			
			var opCode = data_struct.inputStruct[data_struct.counter] % 100;
			
			switch(opCode) {
				
				case 1:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 3);
					var value1 = getValue(data_struct.inputStruct, params[0], data_struct.base);
					var value2 = getValue(data_struct.inputStruct, params[1], data_struct.base);
					putValue(data_struct.inputStruct, params[2], value1+value2, data_struct.base);
					
					data_struct.counter+=4;
					break;
				case 2:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 3);
					var value1 = getValue(data_struct.inputStruct, params[0], data_struct.base);
					var value2 = getValue(data_struct.inputStruct, params[1], data_struct.base);
					putValue(data_struct.inputStruct, params[2], value1*value2, data_struct.base);
					
					data_struct.counter+=4;
					break;
				case 3:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 1);
					if (inputCounter >= inputArray.length) {
						return "END";
					}
					var input = inputArray[inputCounter];
					inputCounter++;
					putValue(data_struct.inputStruct, params[0], input, data_struct.base);
					
					data_struct.counter+=2;
					break;
				case 4:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 1);
					var outputId = getValue(data_struct.inputStruct, params[0], data_struct.base);
					
					data_struct.counter+=2;
					return outputId;
					break;
				case 5:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 2);
					
					if (getValue(data_struct.inputStruct, params[0], data_struct.base) != 0) {
						data_struct.counter = getValue(data_struct.inputStruct, params[1], data_struct.base);						
					} else {
						data_struct.counter+=3;
					}
					break;
				case 6:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 2);
					
					if (getValue(data_struct.inputStruct, params[0], data_struct.base) == 0) {
						data_struct.counter = getValue(data_struct.inputStruct, params[1], data_struct.base);						
					} else {
						data_struct.counter+=3;
					}
					break;
				case 7:	
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 3);
					var value1 = getValue(data_struct.inputStruct, params[0], data_struct.base);
					var value2 = getValue(data_struct.inputStruct, params[1], data_struct.base);
					
					if (value1 < value2) {
						putValue(data_struct.inputStruct, params[2], 1, data_struct.base);				
					} else {
						putValue(data_struct.inputStruct, params[2], 0, data_struct.base);				
					}
					
					data_struct.counter+=4;
					break;
				case 8:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 3);
					var value1 = getValue(data_struct.inputStruct, params[0], data_struct.base);
					var value2 = getValue(data_struct.inputStruct, params[1], data_struct.base);
					
					if (value1 == value2) {
						putValue(data_struct.inputStruct, params[2], 1, data_struct.base);				
					} else {
						putValue(data_struct.inputStruct, params[2], 0, data_struct.base);				
					}
					
					data_struct.counter+=4;
					break;
				case 9:
					var params = getParameters(data_struct.inputStruct, data_struct.counter, 1);
					data_struct.base += getValue(data_struct.inputStruct, params[0], data_struct.base);
					
					data_struct.counter+=2;
					break;
				case 99:
					return "END";
					break;
				default:
					throw("BAD OPCODE: "+opCode);
			}
		}
	}
</script>